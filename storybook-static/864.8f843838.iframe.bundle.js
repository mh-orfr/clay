"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[864],{"./packages/clay-core/src/collection/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{FE:()=>Collection,L2:()=>excludeProps,km:()=>getKey,Kx:()=>useCollection,Pn:()=>useCollectionKeys,oq:()=>useVirtual});__webpack_require__("./node_modules/core-js/modules/es.string.starts-with.js"),__webpack_require__("./node_modules/core-js/modules/es.array.reduce.js"),__webpack_require__("./node_modules/core-js/modules/es.object.keys.js");function getKey(index,key,parentKey){return null==key||String(key).startsWith(".")&&!String(key).startsWith(".$")?parentKey?parentKey+"."+index:"$."+index:key}function excludeProps(props,items){return Object.keys(props).reduce((function(previous,key){return items.has(key)||(previous[key]=props[key]),previous}),{})}__webpack_require__("./node_modules/core-js/modules/es.array.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.string.includes.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.js"),__webpack_require__("./node_modules/core-js/modules/es.array.filter.js"),__webpack_require__("./node_modules/core-js/modules/es.object.assign.js");var react=__webpack_require__("./node_modules/react/index.js"),src=(__webpack_require__("./node_modules/core-js/modules/es.map.js"),__webpack_require__("./node_modules/core-js/modules/es.object.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.string.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.iterator.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.is-array.js"),__webpack_require__("./node_modules/core-js/modules/es.array.concat.js"),__webpack_require__("./node_modules/core-js/modules/es.array.for-each.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.for-each.js"),__webpack_require__("./node_modules/core-js/modules/es.array.map.js"),__webpack_require__("./node_modules/core-js/modules/es.set.js"),__webpack_require__("./node_modules/core-js/modules/es.array.from.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.description.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.slice.js"),__webpack_require__("./node_modules/core-js/modules/es.function.name.js"),__webpack_require__("./packages/clay-shared/src/index.tsx")),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}var CollectionContext=react.createContext({}),SECTION_NAMES=["Group","Section"];function getItemId(value,key){return"object"==typeof value?value[key]:value}function useCollection(_ref){var children=_ref.children,_ref$connectNested=_ref.connectNested,connectNested=void 0===_ref$connectNested||_ref$connectNested,exclude=_ref.exclude,filter=_ref.filter,filterKey=_ref.filterKey,forceDeepRootUpdate=_ref.forceDeepRootUpdate,ItemContainer=_ref.itemContainer,_ref$itemIdKey=_ref.itemIdKey,itemIdKey=void 0===_ref$itemIdKey?"id":_ref$itemIdKey,items=_ref.items,notFound=_ref.notFound,parentKey=_ref.parentKey,_ref$passthroughKey=_ref.passthroughKey,passthroughKey=void 0===_ref$passthroughKey||_ref$passthroughKey,publicApi=_ref.publicApi,_ref$suppressTextValu=_ref.suppressTextValueWarning,suppressTextValueWarning=void 0===_ref$suppressTextValu||_ref$suppressTextValu,virtualizer=_ref.virtualizer,visibleKeys=_ref.visibleKeys,_useContext=(0,react.useContext)(CollectionContext),forceUpdate=_useContext.forceUpdate,parentLayout=_useContext.layout,layoutRef=(0,react.useRef)(new Map),layoutKeysRef=(0,react.useRef)(new Map),keysRef=(0,react.useRef)([]),setForceUpdate=_slicedToArray((0,react.useReducer)((function(renders){return renders+1}),0),2)[1],collectionId=(0,src.useId)(),layout=null!=parentLayout?parentLayout:layoutRef,performFilter=(0,react.useCallback)((function(child){return!!filter&&("string"==typeof child.props.children?!filter(child.props.children):!(!filterKey||!child.props[filterKey])&&!filter(child.props[filterKey]))}),[filter]),performItemRender=(0,react.useCallback)((function(child,key,index,item,props){if(!performFilter(child)){if(ItemContainer)return(0,jsx_runtime.jsx)(ItemContainer,{index,item,keyValue:key,children:props?react.cloneElement(child,props):child},key);var hasChildNeedPassthroughKey=child.type.passthroughKey;return react.cloneElement(child,Object.assign({key},passthroughKey||hasChildNeedPassthroughKey?Object.assign({index,keyValue:key},suppressTextValueWarning?{}:{textValue:getTextValue(key,child,!0)}):{},props||{}))}}),[ItemContainer,performFilter]),createItemsLayout=(0,react.useCallback)((function(_ref2){var children=_ref2.children,items=_ref2.items;keysRef.current=[],layoutKeysRef.current.clear();var callNestedChild=function callNestedChild(child){if(child.type.displayName&&SECTION_NAMES.includes(child.type.displayName)){var _child$props=child.props,_children=_child$props.children,_items=_child$props.items;createItemsLayout({children:_children,items:_items})}};function registerItem(key,child,index){if(!performFilter(child)){"Item"===child.type.displayName&&layout.current.set(key,{index,instanceId:collectionId,value:getTextValue(key,child,suppressTextValueWarning)});var prevKey=keysRef.current[keysRef.current.length-1];keysRef.current.push(key),layoutKeysRef.current.set(key,{prevKey}),prevKey&&layoutKeysRef.current.has(prevKey)&&layoutKeysRef.current.set(prevKey,Object.assign({},layoutKeysRef.current.get(prevKey),{nextKey:key}))}}if(items&&children instanceof Function)for(var index=0;index<items.length;index++){var _child$key,item=items[index],publicItem=exclude&&"object"==typeof item?excludeProps(item,exclude):item,child=Array.isArray(publicApi)?children.apply(void 0,[publicItem].concat(_toConsumableArray(publicApi))):children(publicItem,index);callNestedChild(child);var key=getKey(index,null!==(_child$key=child.key)&&void 0!==_child$key?_child$key:getItemId(item,itemIdKey),parentKey);"object"==typeof item&&(item._key=key),registerItem(key,child,index)}else react.Children.forEach(children,(function(child,index){react.isValidElement(child)&&(callNestedChild(child),registerItem(getKey(index,child.key,parentKey),child,index))}))}),[performFilter,publicApi,itemIdKey]),virtualizerItems=null==virtualizer?void 0:virtualizer.getVirtualItems(),performCollectionRender=(0,react.useCallback)((function(_ref3){var children=_ref3.children,items=_ref3.items;return children instanceof Function&&items?virtualizer?virtualizer.getVirtualItems().map((function(virtual){var _child$key2,item=items[virtual.index],publicItem=exclude&&"object"==typeof item?excludeProps(item,exclude):item,child=Array.isArray(publicApi)?children.apply(void 0,[publicItem].concat(_toConsumableArray(publicApi))):children(publicItem,virtual.index),props={"data-index":virtual.index,ref:function ref(node){virtualizer.measureElement(node);var ref=child.ref;"function"==typeof ref&&ref(node)},style:{left:0,position:"absolute",top:0,transform:"translateY("+virtual.start+"px)",width:"100%"}};return performItemRender(child,getKey(virtual.index,null!==(_child$key2=child.key)&&void 0!==_child$key2?_child$key2:getItemId(item,itemIdKey),parentKey),virtual.index,item,props)})):items.map((function(item,index){var _child$key3,publicItem=exclude&&"object"==typeof item?excludeProps(item,exclude):item,child=Array.isArray(publicApi)?children.apply(void 0,[publicItem].concat(_toConsumableArray(publicApi))):children(publicItem,index),key=getKey(index,null!==(_child$key3=child.key)&&void 0!==_child$key3?_child$key3:getItemId(item,itemIdKey),parentKey);return visibleKeys&&(Array.isArray(visibleKeys)&&visibleKeys.length>0&&!visibleKeys.includes(index)||visibleKeys instanceof Set&&visibleKeys.size>0&&!visibleKeys.has(key))?null:performItemRender(child,key,index,item)})):react.Children.map(children,(function(child,index){if(!react.isValidElement(child))return null;var key=getKey(index,child.key,parentKey);return visibleKeys&&(Array.isArray(visibleKeys)&&visibleKeys.length>0&&!visibleKeys.includes(index)||visibleKeys instanceof Set&&visibleKeys.size>0&&!visibleKeys.has(key))?null:performItemRender(child,key,index)}))}),[performItemRender,publicApi,null==virtualizerItems?void 0:virtualizerItems.length,visibleKeys,itemIdKey]),getItem=(0,react.useCallback)((function(key){return layout.current.get(key)}),[]),hasItem=(0,react.useCallback)((function(key){return layout.current.has(key)}),[]),getFirstItem=(0,react.useCallback)((function(){var key=layout.current.keys().next().value;return Object.assign({key},layout.current.get(key))}),[]),getLastItem=(0,react.useCallback)((function(){var key=Array.from(layout.current.keys()).pop();return Object.assign({key},layout.current.get(key))}),[]),getItems=(0,react.useCallback)((function(){return Array.from(layout.current.keys())}),[]),getSize=(0,react.useCallback)((function(){return layout.current.size}),[collectionId]),cleanUp=(0,react.useCallback)((function(){layout.current.forEach((function(value,key){value.instanceId===collectionId&&layout.current.delete(key)}))}),[]);(0,react.useMemo)((function(){parentLayout||cleanUp(),createItemsLayout({children,items})}),[children,createItemsLayout,items]);var rendered=(0,react.useMemo)((function(){var list=performCollectionRender({children,items});return 0===list.length&&notFound?notFound:list}),[children,performCollectionRender,items]);return(0,react.useEffect)((function(){return function(){forceUpdate&&(cleanUp(),forceUpdate(null))}}),[]),(0,react.useEffect)((function(){forceUpdate&&forceUpdate(null)}),[children,createItemsLayout,performCollectionRender,items]),{UNSAFE_virtualizer:virtualizer,collection:connectNested?(0,jsx_runtime.jsx)(CollectionContext.Provider,{value:{forceUpdate:forceDeepRootUpdate?setForceUpdate:void 0,keys:layoutKeysRef,layout},children:rendered}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:rendered}),getFirstItem,getItem,getItems,getLastItem,getSize,hasItem,size:virtualizer?virtualizer.getTotalSize():void 0,virtualize:!!virtualizer}}function useCollectionKeys(){return(0,react.useContext)(CollectionContext).keys}function getTextValue(key,child,suppressTextValueWarning){return"string"==typeof child.props.children?child.props.children:child.props.textValue?child.props.textValue:(suppressTextValueWarning||console.warn('Clay: <Item key="'+key+'" /> with non-plain text content is not compatible with the type being selected. Please add a `textValue` prop.'),"")}var lib=__webpack_require__("./node_modules/@tanstack/react-virtual/build/lib/index.mjs");function useVirtual(_ref){var _estimateSize=_ref.estimateSize,_ref$items=_ref.items,items=void 0===_ref$items?[]:_ref$items,parentRef=_ref.parentRef,virtualizer=(0,lib.MG)({count:items.length,estimateSize:function estimateSize(){return _estimateSize},getScrollElement:function getScrollElement(){return parentRef.current},overscan:7}),previousLengthRef=(0,react.useRef)(items.length);return(0,react.useEffect)((function(){items.length<previousLengthRef.current&&items.length>0&&virtualizer.scrollToIndex(0,{behavior:"auto"}),previousLengthRef.current=items.length}),[items.length]),virtualizer}var _excluded=["as","children","connectNested","estimateSize","exclude","filter","filterKey","itemContainer","items","parentKey","parentRef","passthroughKey","publicApi"],_excluded2=["as","children","collection","connectNested","estimateSize","exclude","filter","filterKey","isLoading","itemContainer","itemIdKey","items","onLoadMore","parentKey","parentRef","passthroughKey","publicApi","suppressTextValueWarning","virtualize"];function _objectWithoutProperties(e,t){if(null==e)return{};var o,r,i=function _objectWithoutPropertiesLoose(r,e){if(null==r)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.includes(n))continue;t[n]=r[n]}return t}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)o=s[r],t.includes(o)||{}.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}function VirtualDynamicCollection(_ref){var as=_ref.as,children=_ref.children,connectNested=_ref.connectNested,_ref$estimateSize=_ref.estimateSize,estimateSize=void 0===_ref$estimateSize?37:_ref$estimateSize,exclude=_ref.exclude,filter=_ref.filter,filterKey=_ref.filterKey,itemContainer=_ref.itemContainer,items=_ref.items,parentKey=_ref.parentKey,parentRef=_ref.parentRef,passthroughKey=_ref.passthroughKey,publicApi=_ref.publicApi,otherProps=_objectWithoutProperties(_ref,_excluded),state=useCollection({children,connectNested,exclude,filter,filterKey,itemContainer,items,parentKey,passthroughKey,publicApi,virtualizer:useVirtual({estimateSize,items,parentRef})}),As=null!=as?as:react.Fragment;return(0,jsx_runtime.jsx)(As,Object.assign({},otherProps,{style:{height:state.size+"px",position:"relative",width:"100%"},children:state.collection}))}function DynamicCollection(_ref2){var state=useCollection({children:_ref2.children,connectNested:_ref2.connectNested,exclude:_ref2.exclude,filter:_ref2.filter,filterKey:_ref2.filterKey,itemContainer:_ref2.itemContainer,itemIdKey:_ref2.itemIdKey,items:_ref2.items,parentKey:_ref2.parentKey,passthroughKey:_ref2.passthroughKey,publicApi:_ref2.publicApi,suppressTextValueWarning:_ref2.suppressTextValueWarning});return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:state.collection})}function Collection(_ref3){var content,as=_ref3.as,children=_ref3.children,collection=_ref3.collection,connectNested=_ref3.connectNested,estimateSize=_ref3.estimateSize,exclude=_ref3.exclude,filter=_ref3.filter,filterKey=_ref3.filterKey,isLoading=_ref3.isLoading,itemContainer=_ref3.itemContainer,_ref3$itemIdKey=_ref3.itemIdKey,itemIdKey=void 0===_ref3$itemIdKey?"id":_ref3$itemIdKey,items=_ref3.items,onLoadMore=_ref3.onLoadMore,parentKey=_ref3.parentKey,parentRef=_ref3.parentRef,_ref3$passthroughKey=_ref3.passthroughKey,passthroughKey=void 0===_ref3$passthroughKey||_ref3$passthroughKey,publicApi=_ref3.publicApi,suppressTextValueWarning=_ref3.suppressTextValueWarning,_ref3$virtualize=_ref3.virtualize,virtualize=void 0!==_ref3$virtualize&&_ref3$virtualize,otherProps=_objectWithoutProperties(_ref3,_excluded2),containerRef=(0,react.useRef)(null),isVirtual=null==collection?void 0:collection.virtualize,Container=as||(isVirtual?"div":react.Fragment),onScroll=(0,react.useCallback)((function(event){var target=event.target;target.scrollTop+target.clientHeight>=target.scrollHeight-40&&!isLoading&&onLoadMore()}),[onLoadMore,isLoading]);if((0,react.useEffect)((function(){if(onLoadMore&&containerRef.current){var element=containerRef.current.parentElement;return element.addEventListener("scroll",onScroll,!0),function(){element.removeEventListener("scroll",onScroll,!0)}}}),[onScroll]),collection)content=(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:collection.collection});else{if(virtualize&&children instanceof Function&&items&&parentRef)return(0,jsx_runtime.jsx)(VirtualDynamicCollection,Object.assign({},otherProps,{as,connectNested,estimateSize,itemContainer,itemIdKey,items,parentKey,parentRef,passthroughKey,publicApi,suppressTextValueWarning,children}));content=(0,jsx_runtime.jsx)(DynamicCollection,{connectNested,exclude,filter,filterKey,itemContainer,itemIdKey,items,parentKey,passthroughKey,publicApi,suppressTextValueWarning,children})}var virtualProps=isVirtual?{style:{height:collection.size+"px",position:"relative",width:"100%"}}:{},props=as||isVirtual?{ref:containerRef}:{};return(0,jsx_runtime.jsx)(Container,Object.assign({},otherProps,virtualProps,props,{children:content}))}VirtualDynamicCollection.displayName="VirtualDynamicCollection",Collection.displayName="Collection"}}]);