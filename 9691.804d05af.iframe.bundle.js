"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9691],{"./packages/clay-data-provider/src/useResource.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{GE:()=>FetchPolicy,Ie:()=>NetworkStatus,Wf:()=>useResource});__webpack_require__("./node_modules/core-js/modules/es.string.link.js"),__webpack_require__("./node_modules/core-js/modules/web.timers.js"),__webpack_require__("./node_modules/core-js/modules/es.array.is-array.js"),__webpack_require__("./node_modules/core-js/modules/es.array.concat.js"),__webpack_require__("./node_modules/core-js/modules/es.object.assign.js"),__webpack_require__("./node_modules/core-js/modules/es.object.keys.js"),__webpack_require__("./node_modules/core-js/modules/es.array.for-each.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.for-each.js"),__webpack_require__("./node_modules/core-js/modules/web.url.js"),__webpack_require__("./node_modules/core-js/modules/es.object.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.string.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.iterator.js"),__webpack_require__("./node_modules/core-js/modules/web.dom-collections.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.regexp.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.date.to-string.js"),__webpack_require__("./node_modules/core-js/modules/es.promise.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.description.js"),__webpack_require__("./node_modules/core-js/modules/es.symbol.iterator.js"),__webpack_require__("./node_modules/core-js/modules/es.array.slice.js"),__webpack_require__("./node_modules/core-js/modules/es.function.name.js"),__webpack_require__("./node_modules/core-js/modules/es.array.from.js");var FetchPolicy,NetworkStatus,src=__webpack_require__("./packages/clay-provider/src/index.ts"),clay_shared_src=__webpack_require__("./packages/clay-shared/src/index.tsx"),react=__webpack_require__("./node_modules/react/index.js"),fast_json_stable_stringify=(__webpack_require__("./node_modules/warning/warning.js"),__webpack_require__("./node_modules/fast-json-stable-stringify/index.js")),fast_json_stable_stringify_default=__webpack_require__.n(fast_json_stable_stringify),timeout=function timeout(ms,promise,controller){return new Promise((function(resolve,reject){var timeoutId=setTimeout((function(){null==controller||controller.abort(),reject(new Error("timeout"))}),ms);promise.then((function(res){clearTimeout(timeoutId),resolve(res)})).catch((function(error){clearTimeout(timeoutId),reject(error)}))}))};function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _slicedToArray(r,e){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(r,e)||_unsupportedIterableToArray(r,e)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,a){if(r){if("string"==typeof r)return _arrayLikeToArray(r,a);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,a):void 0}}function _arrayLikeToArray(r,a){(null==a||a>r.length)&&(a=r.length);for(var e=0,n=Array(a);e<a;e++)n[e]=r[e];return n}!function(FetchPolicy){FetchPolicy.CacheFirst="cache-first",FetchPolicy.NoCache="no-cache",FetchPolicy.CacheAndNetwork="cache-and-network"}(FetchPolicy||(FetchPolicy={})),function(NetworkStatus){NetworkStatus[NetworkStatus.Error=5]="Error",NetworkStatus[NetworkStatus.Loading=1]="Loading",NetworkStatus[NetworkStatus.Polling=3]="Polling",NetworkStatus[NetworkStatus.Refetch=2]="Refetch",NetworkStatus[NetworkStatus.Unused=4]="Unused"}(NetworkStatus||(NetworkStatus={}));var idCounter=0,useResource=function useResource(_ref){var _client$current$read,fetcher=_ref.fetch,_ref$fetchDelay=_ref.fetchDelay,fetchDelay=void 0===_ref$fetchDelay?300:_ref$fetchDelay,fetchOptions=_ref.fetchOptions,_ref$fetchPolicy=_ref.fetchPolicy,fetchPolicy=void 0===_ref$fetchPolicy?FetchPolicy.NoCache:_ref$fetchPolicy,_ref$fetchRetry=_ref.fetchRetry,fetchRetry=void 0===_ref$fetchRetry?{}:_ref$fetchRetry,_ref$fetchTimeout=_ref.fetchTimeout,fetchTimeout=void 0===_ref$fetchTimeout?6e3:_ref$fetchTimeout,link=_ref.link,_ref$onNetworkStatusC=_ref.onNetworkStatusChange,onNetworkStatusChange=void 0===_ref$onNetworkStatusC?function(){}:_ref$onNetworkStatusC,_ref$pollInterval=_ref.pollInterval,pollInterval=void 0===_ref$pollInterval?0:_ref$pollInterval,storageMaxSize=_ref.storageMaxSize,_ref$suspense=_ref.suspense,suspense=void 0!==_ref$suspense&&_ref$suspense,_ref$variables=_ref.variables,variables=void 0===_ref$variables?null:_ref$variables;fetchPolicy===FetchPolicy.NoCache&&suspense&&(fetchPolicy=FetchPolicy.CacheAndNetwork);var pollingTimeoutIdRef=(0,react.useRef)(null),retryDelayTimeoutIdRef=(0,react.useRef)(null),abortController=(0,react.useRef)(null),networkStatusRef=(0,react.useRef)(),pollIntervalRef=(0,react.useRef)(pollInterval),uid=(0,react.useMemo)((function(){return idCounter++,String(idCounter)}),[]),firstRenderRef=(0,react.useRef)(!0),firstRequestRef=(0,react.useRef)(!1),shouldUseCache=fetchPolicy===FetchPolicy.CacheFirst||fetchPolicy===FetchPolicy.CacheAndNetwork,identifier=(0,react.useMemo)((function(){return"string"==typeof link?function getIdentifier(link,variables,options){var uid=link;if(variables&&(uid+=fast_json_stable_stringify_default()(variables)),"object"==typeof options){for(var serializedOptions=Object.assign({},options),keys=Object.keys(options),index=0;index<keys.length;index++){var key=keys[index],value=options[key];value instanceof URLSearchParams&&(serializedOptions[key]=value.toString())}uid+=fast_json_stable_stringify_default()(serializedOptions)}return uid}(link,variables,fetchOptions):uid}),[link,variables,fetchOptions]),globalClient=(0,src.useProvider)().client,client=(0,react.useRef)(null!=globalClient?globalClient:new src.__UNSTABLE_DataClient({storageMaxSize})),_useState2=_slicedToArray((0,react.useState)(null),2),sort=_useState2[0],setSort=_useState2[1],_useState4=_slicedToArray((0,react.useState)(null!==(_client$current$read=client.current.read(identifier))&&void 0!==_client$current$read?_client$current$read:null),2),resource=_useState4[0],setResource=_useState4[1],debouncedVariablesChange=(0,clay_shared_src.useDebounce)(variables,fetchDelay),dispatchNetworkStatus=function dispatchNetworkStatus(status){onNetworkStatusChange(status),networkStatusRef.current=status},cleanRetry=function cleanRetry(){retryDelayTimeoutIdRef.current&&clearTimeout(retryDelayTimeoutIdRef.current)},handleFetchRetry=function handleFetchRetry(error,retryAttempts){var _fetchRetry$attempts=fetchRetry.attempts,attempts=void 0===_fetchRetry$attempts?5:_fetchRetry$attempts;if(cleanRetry(),attempts>0&&retryAttempts<attempts){var delay=function getRetryDelay(retryAttempts){var _fetchRetry$delay=fetchRetry.delay,delay=void 0===_fetchRetry$delay?{}:_fetchRetry$delay,_delay$initial=delay.initial,initial=void 0===_delay$initial?300:_delay$initial,_delay$jitter=delay.jitter,jitter=void 0===_delay$jitter||_delay$jitter,value=(jitter?initial:initial/2)*Math.pow(2,retryAttempts);return jitter&&(value=Math.random()*value),value}(retryAttempts);console.warn("DataProvider: Trying "+(retryAttempts+1)+" of "+attempts+" will happen in "+delay+"ms"),retryDelayTimeoutIdRef.current=setTimeout((function(){doFetch(retryAttempts+1)}),delay)}else suspense?client.current.update(identifier,error):dispatchNetworkStatus(NetworkStatus.Error)},cleanPoll=function cleanPoll(){return pollingTimeoutIdRef.current&&clearTimeout(pollingTimeoutIdRef.current)},setPoll=function setPoll(){cleanPoll(),pollingTimeoutIdRef.current=setTimeout((function(){maybeFetch(NetworkStatus.Polling)}),pollIntervalRef.current)},fetchOnComplete=function fetchOnComplete(result){cleanRetry();var data=result,cursor=client.current.getCursor(identifier);return networkStatusRef.current!==NetworkStatus.Loading||!cursor&&null!==cursor||null==resource||(Array.isArray(result)&&Array.isArray(resource)?data=[].concat(_toConsumableArray(resource),_toConsumableArray(result)):"object"==typeof result&&"object"==typeof resource&&(data=Object.assign({},resource,result))),setResource(data),dispatchNetworkStatus(NetworkStatus.Unused),shouldUseCache&&client.current.update(identifier,data),pollIntervalRef.current>0&&setPoll(),result},populateSearchParams=function populateSearchParams(uri,variables){return variables?(Object.keys(variables).forEach((function(key){return uri.searchParams.set(key,variables[key])})),uri):uri},getUrlFormat=function getUrlFormat(link,variables){var uri=new URL(link);return client.current.getCursor(identifier),variables?(populateSearchParams(uri,variables),uri.toString()):uri.toString()},doFetch=function doFetch(){var retryAttempts=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,doSort=arguments.length>1?arguments[1]:void 0;switch(typeof link){case"function":return timeout(fetchTimeout,link(populateSearchParams(new URL("http://clay.data.provider"),variables).searchParams.toString())).then(fetchOnComplete).catch((function(error){return handleFetchRetry(error,retryAttempts)}));case"string":var _client$current$getCu,fn=null!=fetcher?fetcher:fetch,nextCursor=void 0;return abortController.current&&abortController.current.abort(),abortController.current=new AbortController,timeout(fetchTimeout,fn(getUrlFormat(null!==(_client$current$getCu=client.current.getCursor(identifier))&&void 0!==_client$current$getCu?_client$current$getCu:link,variables),Object.assign({},fetchOptions,{signal:abortController.current.signal}),doSort||sort||void 0),abortController.current).then((function(res){return res instanceof Response&&res.ok&&!res.bodyUsed?res.json():res instanceof Response||!res.items||!res.cursor&&null!==res.cursor?res:(nextCursor=res.cursor,res.items)})).then(fetchOnComplete).then((function(res){return void 0!==nextCursor&&client.current.setCursor(identifier,nextCursor),res})).catch((function(error){return handleFetchRetry(error,retryAttempts)}));default:return null}},maybeFetch=function maybeFetch(status){var data=client.current.read(identifier);return(!shouldUseCache||!data||(fetchOnComplete(data),fetchPolicy!==FetchPolicy.CacheFirst))&&(dispatchNetworkStatus(status),doFetch())};(0,react.useEffect)((function(){pollIntervalRef.current=pollInterval,pollInterval>0&&setPoll()}),[pollInterval]),(0,react.useEffect)((function(){firstRenderRef.current||(shouldUseCache||delete client.current.cursors[identifier],maybeFetch(NetworkStatus.Refetch))}),[debouncedVariablesChange]),(0,react.useEffect)((function(){return firstRenderRef.current=!1,function(){pollIntervalRef.current=0,cleanPoll(),cleanRetry()}}),[]);var fetchingOrError=client.current.isFetching(identifier);if(!fetchingOrError&&firstRenderRef.current){var result=maybeFetch(NetworkStatus.Loading);result&&(firstRequestRef.current=!0,fetchingOrError=result,client.current.update(identifier,result))}if(fetchingOrError&&!1===firstRequestRef.current&&!suspense&&(firstRequestRef.current=!0,fetchingOrError instanceof Promise&&fetchingOrError.then(fetchOnComplete)),suspense&&null===resource&&(fetchingOrError instanceof Promise||fetchingOrError instanceof Error))throw fetchingOrError;return{loadMore:function loadMore(){return client.current.getCursor(identifier)?(dispatchNetworkStatus(NetworkStatus.Loading),doFetch()):null},refetch:function refetch(){shouldUseCache||delete client.current.cursors[identifier],dispatchNetworkStatus(NetworkStatus.Refetch),doFetch()},resource,sort,sortChange:function onSortChange(sort){setSort(sort),doFetch(0,sort)}}}},"./node_modules/core-js/modules/es.string.link.js":(__unused_webpack_module,__unused_webpack_exports,__webpack_require__)=>{var $=__webpack_require__("./node_modules/core-js/internals/export.js"),createHTML=__webpack_require__("./node_modules/core-js/internals/create-html.js");$({target:"String",proto:!0,forced:__webpack_require__("./node_modules/core-js/internals/string-html-forced.js")("link")},{link:function link(url){return createHTML(this,"a","href",url)}})},"./node_modules/fast-json-stable-stringify/index.js":module=>{module.exports=function(data,opts){opts||(opts={}),"function"==typeof opts&&(opts={cmp:opts});var f,cycles="boolean"==typeof opts.cycles&&opts.cycles,cmp=opts.cmp&&(f=opts.cmp,function(node){return function(a,b){var aobj={key:a,value:node[a]},bobj={key:b,value:node[b]};return f(aobj,bobj)}}),seen=[];return function stringify(node){if(node&&node.toJSON&&"function"==typeof node.toJSON&&(node=node.toJSON()),void 0!==node){if("number"==typeof node)return isFinite(node)?""+node:"null";if("object"!=typeof node)return JSON.stringify(node);var i,out;if(Array.isArray(node)){for(out="[",i=0;i<node.length;i++)i&&(out+=","),out+=stringify(node[i])||"null";return out+"]"}if(null===node)return"null";if(-1!==seen.indexOf(node)){if(cycles)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var seenIndex=seen.push(node)-1,keys=Object.keys(node).sort(cmp&&cmp(node));for(out="",i=0;i<keys.length;i++){var key=keys[i],value=stringify(node[key]);value&&(out&&(out+=","),out+=JSON.stringify(key)+":"+value)}return seen.splice(seenIndex,1),"{"+out+"}"}}(data)}}}]);